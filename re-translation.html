<style>
    /* ...既存のスタイル... */
    .final-result {
        margin-top: 20px;
        padding: 20px;
        background: #000;
        border: 3px solid var(--accent);
        border-radius: 10px;
        display: none; /* 初期は非表示 */
        animation: pulse 2s infinite;
    }
    .final-title {
        color: var(--accent);
        font-weight: bold;
        font-size: 0.9rem;
        margin-bottom: 10px;
        text-align: center;
        text-transform: uppercase;
    }
    .final-text {
        font-size: 1.3rem;
        line-height: 1.5;
        text-align: center;
        font-weight: bold;
    }
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 255, 0, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(255, 255, 0, 0); }
        100% { box-shadow: 0 0 0 0 rgba(255, 255, 0, 0); }
    }
</style>

<div id="finalArea" class="final-result">
    <div class="final-title">✨ 最終結果 ✨</div>
    <div id="finalText" class="final-text"></div>
</div>

<script>
    async function startReTranslation() {
        const input = document.getElementById('inputText').value;
        const logArea = document.getElementById('logArea');
        const finalArea = document.getElementById('finalArea');
        const finalText = document.getElementById('finalText');
        const btn = document.getElementById('mainBtn');
        
        if (!input) return;

        btn.disabled = true;
        btn.innerText = "翻訳中...";
        logArea.innerHTML = "";
        finalArea.style.display = "none"; // 前回の結果を隠す
        
        let currentText = input;

        for (let i = 0; i < languages.length; i++) {
            // ...既存のループ処理...
            const lang = languages[i];
            const box = document.createElement('div');
            box.className = 'step-box';
            box.innerHTML = `<div class="step-header">STEP ${i+1}: ${lang.name} 経由</div><div class="step-jp loading-dots">翻訳中</div>`;
            logArea.appendChild(box);
            window.scrollTo(0, document.body.scrollHeight);

            try {
                let foreignText = await translate(currentText, 'ja', lang.code);
                currentText = await translate(foreignText, lang.code, 'ja');
                box.innerHTML = `<div class="step-header">STEP ${i+1}: ${lang.name}</div><div class="step-jp">${currentText}</div>`;
            } catch (e) {
                box.innerHTML = `<div style="color:red;">通信エラー</div>`;
            }
            await new Promise(r => setTimeout(r, 600));
        }

        // --- ここで最終結果を表示 ---
        finalText.innerText = currentText;
        finalArea.style.display = "block";
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });

        btn.disabled = false;
        btn.innerText = "再実行";
    }

    function clearAll() {
        if(confirm("全て削除しますか？")) {
            document.getElementById('inputText').value = "";
            document.getElementById('logArea').innerHTML = "";
            document.getElementById('finalArea').style.display = "none"; // 最終結果も消す
            document.getElementById('mainBtn').innerText = "実行";
        }
    }
</script>
